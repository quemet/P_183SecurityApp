<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recherche</title>
</head>
<body>
    <script>
        async function fetchAPI() {
            let username = document.getElementById("search").value;
            let arr = await fetch(`http://localhost:3000/users/?username="${username}"`, {
                headers: {
                    "Content-Type": 'application/json',
                    "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjEsImFkbWluIjoxLCJpYXQiOjE3MTU3NjQ4NDIsImV4cCI6MTc0NzMyMjQ0Mn0.nI-5pzz1CWpQld1aXai0JPhYRnRxEEI7lokOhw0lqEE"
                },
            }).then((response) => response.json()).then((data) => data).catch(error => console.error('Error:', error));

            let users = arr.data
        
            let body = document.querySelector("body")

            let allUl = document.querySelectorAll("ul")
            let allP = document.querySelectorAll("p")

            allUl.forEach((ul) => {
                body.removeChild(ul)
            });

            allP.forEach((p) => {
                body.removeChild(p)
            });

            if(users.length == 0) {
                let p = document.createElement("p")
                p.textContent = "Aucun utilisateur ne correspond à ces critères"
                p.style.fontSize = "35px"
                body.appendChild(p)
                return
            }

            let ul = document.createElement("ul")
            body.appendChild(ul)

            users.forEach((user) => {
                let li = document.createElement("li")
                li.textContent = user.username
                ul.appendChild(li)
            });
        }
    </script>

    <form>
        <input type="search" name="search" id="search" />
        <input type="button" value="Submit" onclick="fetchAPI()" >
    </form>
</body>
</html>